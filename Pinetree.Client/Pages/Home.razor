@page "/"
@using Pinetree.Client.Services
@using Pinetree.Shared.Resources
@using Microsoft.Extensions.Localization
@using Microsoft.AspNetCore.Components
@inject IJSRuntime JSRuntime
@inject IStringLocalizer<SharedResources> Localizer
@inject LanguageService LanguageService
@rendermode InteractiveAuto
@implements IAsyncDisposable

<PageTitle>@Localizer["SiteTitle"]</PageTitle>
<HeadContent>
    <meta property="og:title" content=@Localizer["SiteTitle"] />
    <meta name="twitter:title" content=@Localizer["SiteTitle"] />
    <meta name="description" content=@Localizer["SiteDescription"] />
    <meta property="og:description" content=@Localizer["SiteDescription"] />
    <meta name="twitter:description" content=@Localizer["SiteDescription"] />
    <meta property="og:url" content=@Url />
    <link rel="canonical" href=@Url />
</HeadContent>

<div class="position-relative">
    <!-- Language Selector -->
    <div class="language-selector" style="position: absolute; top: 10px; right: 10px; z-index: 1000;">
        <select class="form-select form-select-sm" style="width: auto;" @onchange="OnLanguageChanged">
            @foreach (var lang in LanguageService.GetSupportedLanguages())
            {
                <option value="@lang" selected="@(lang == LanguageService.CurrentCulture.TwoLetterISOLanguageName)">
                    @LanguageService.GetLanguageDisplayName(lang)
                </option>
            }
        </select>
    </div>

    <!-- Main Content - Centered -->
    <div style="display: flex; justify-content: center; align-items: center; text-align: center; flex-direction: column;">

        <h1 style="font-size: 4em; margin-top: 50px;">
            <img src="img/Pinetree64.webp" alt="Pinetree logo" width="64" height="64">
            @((MarkupString)string.Format(Localizer["MainHeading"], $"<span class=\"highlight-text\">{Localizer["Hierarchical"]}</span>"))
        </h1>
        <div class="mt-4 button-container">
            <a class="btn btn-outline-primary btn-lg m-2" href="/play"><i class="bi bi-tools"></i>@Localizer["Playground"]</a>
            <a class="btn btn-outline-success btn-lg m-2" href="Account/Register"><i class="bi bi-person"></i>@Localizer["Register"]</a>
        </div>
        <div class="slider-container mt-4">            
            <div class="slider" id="imageSlider">
                <div class="slide active">
                    <img src="img/PinetreeScreen.webp" alt="Pinetree Screenshot 1" class="main-image" />
                </div>
                <div class="slide">
                    <img src="img/PinetreeScreen2.webp" alt="Pinetree Screenshot 2" class="main-image" />
                </div>
                <div class="slide">
                    <img src="img/PinetreeScreen3.webp" alt="Pinetree Screenshot 3" class="main-image" />
                </div>
            </div>
            <div class="slider-controls">
                <button class="slider-arrow prev" @onclick="PrevSlide">❮</button>
                <div class="slider-dots">
                    <span class="dot active" @onclick="() => SetSlide(0)"></span>
                    <span class="dot" @onclick="() => SetSlide(1)"></span>
                    <span class="dot" @onclick="() => SetSlide(2)"></span>
                </div>
                <button class="slider-arrow next" @onclick="NextSlide">❯</button>
            </div>
        </div>

        <!-- Hierarchical emphasis section -->
        <div class="hierarchical-emphasis my-5 py-4">
            <h2 class="mb-4">@((MarkupString)string.Format(Localizer["WhatIsHierarchicalMarkdownEditor"], $"<span class=\"highlight-text\">{Localizer["Hierarchical"]}</span>"))</h2>

            <div class="concept-box">
                <div class="concept-icon">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <div class="concept-content">
                    <p class="mb-0">
                        @Localizer["OnePagerConcept"]
                    </p>
                </div>
            </div>

            <div class="concept-box">
                <div class="concept-icon">
                    <i class="bi bi-diagram-3"></i>
                </div>
                <div class="concept-content">
                    <p class="mb-0">
                        @Localizer["HierarchicalStructure"]
                    </p>
                </div>
            </div>

            <div class="concept-box">
                <div class="concept-icon">
                    <i class="bi bi-layout-text-window"></i>
                </div>
                <div class="concept-content">
                    <p class="mb-0">
                        @Localizer["UseCases"]
                    </p>
                </div>
            </div>
            <blockquote class="mt-4 text-center">
                <p class="fst-italic">@((MarkupString)string.Format(Localizer["CreateMultipleDocuments"], $"<a href=\"Account/Register\" class=\"alert-link\">{Localizer["Register"]}</a>"))</p>
            </blockquote>
        </div>        <!-- Video section -->
        <div class="video-container my-5 pt-4">
            <h2>@Localizer["PinetreeOverviewDemo"]</h2>
            <div class="video-wrapper">
                <iframe width="520"
                        src="https://www.youtube.com/embed/afYPumK4trY"
                        title="Pinetree Overview and Demo"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                </iframe>
            </div>              
            <p class="video-description">
                @Localizer["VideoDescription"]
            </p>
            <div class="alert alert-info mt-3">
                <div class="d-flex align-items-start">
                    <i class="bi bi-info-circle-fill me-2 mt-1"></i>
                    <div>
                        <strong>@Localizer["BetaVersionNotice"]</strong> @Localizer["BetaVersionDescription"]
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Call to action - Full width with distinct background -->
<div class="cta-container">
    <div class="cta-section">
        <h2>@Localizer["ReadyToGetStarted"]</h2>
        <p>@Localizer["JoinCommunity"]</p>
        <div class="mt-4">
            <a class="btn btn-primary btn-lg m-2" href="/play"><i class="bi bi-tools"></i>@Localizer["Playground"]</a>
            <a class="btn btn-success btn-lg m-2" href="Account/Register"><i class="bi bi-person"></i>@Localizer["Register"]</a>
            <a class="btn btn-info btn-lg m-2" href="/Pricing"><i class="bi bi-tag"></i>@Localizer["Pricing"]</a>
        </div>

        <div class="mt-4">
            <p class="text-muted">
                @Localizer["BetaPhaseDescription"] <br>
                @((MarkupString)string.Format(Localizer["StartWithPlayground"], $"<a href=\"/play\">{Localizer["Playground"]}</a>", $"<a href=\"/Feedback\">{Localizer["Feedback"]}</a>")) <br>
                @Localizer["FreePassReward"] <br>
            </p>
        </div>
    </div>
</div>

@code {
    [Inject]
    public required NavigationManager NavigationManager { get; set; }

    [Inject]
    public required AuthenticationStateProvider AuthenticationStateProvider { get; set; }

    public const string Url = "https://pine-tree.site";

    private IJSObjectReference? _jsModule;

    protected override void OnInitialized()
    {
        LanguageService.OnLanguageChanged += StateHasChanged;
    }

    private void OnLanguageChanged(ChangeEventArgs e)
    {
        if (e.Value?.ToString() is string languageCode)
        {
            LanguageService.SetLanguage(languageCode);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                _jsModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./Pages/Home.razor.js");
                await _jsModule.InvokeVoidAsync("initializeSlider");
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine($"Error initializing slider: {ex.Message}");
            }
        }
    }

    private async Task NextSlide()
    {
        if (_jsModule != null)
        {
            await _jsModule.InvokeVoidAsync("nextSlide");
        }
    }

    private async Task PrevSlide()
    {
        if (_jsModule != null)
        {
            await _jsModule.InvokeVoidAsync("prevSlide");
        }
    }

    private async Task SetSlide(int index)
    {
        if (_jsModule != null)
        {
            await _jsModule.InvokeVoidAsync("setSlide", index);
        }
    }

    public async ValueTask DisposeAsync()
    {
        try
        {
            if (_jsModule != null)
            {
                await _jsModule.InvokeVoidAsync("cleanupSlider");
                await _jsModule.DisposeAsync();
            }
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error disposing slider: {ex.Message}");
        }
        
        LanguageService.OnLanguageChanged -= StateHasChanged;
    }
}